% %% Amplitude 2.5 degrees and frequency 0.2Hz
% close all;
% clc; clear all
% 
% %%%% Fish Path %%%%%
% Fish.Path{1} = '/Users/Projects/RLS/Data/Behavior2019-05-15/F1/5';
% %Fish.Path{2} = '/Users/Projects/RLS/Data/Behavior2019-05-15/F2/10';
% Fish.Path{2} = '/Users/Projects/RLS/Data/Behavior2019-05-16/F1/5';
% Fish.Path{3} = '/Users/Projects/RLS/Data/Behavior2019-05-16/F2/5';
% Fish.Path{4} = '/Users/Projects/RLS/Data/Behavior2019-05-16/F3/5';
% 
% Fish.Title{1} = 'F1-2019/05/15';
% %Fish.Title{2} = 'F2 2019/05/15';
% Fish.Title{2} = 'F1-2019/05/16';
% Fish.Title{3} = 'F2-2019/05/16';
% Fish.Title{4} = 'F3-2019/05/16';
% 
% %%%% Fish Protocoles %%%%%
% NumPro = 5;
% Protocole         = {'Vestibular' ; 'Vestibular+Visual' ; 'Vestibular-Visual' ; 'Visual' ; 'Vestibular+2Visual'};
% Fish.Protocole{1} = [0, 60        ; 60, 120             ; 120, 180            ; 180, 240]';
% %Fish.Protocole{2} = [0, 60        ; 60, 120             ; 120, 180            ; 180, 240]';
% Fish.Protocole{2} = [0, 60        ; 60, 120             ; 120, 180            ; 240, 300 ; 180, 240            ]';
% Fish.Protocole{3} = [0, 60        ; 60, 120             ; 120, 180            ; 240, 300 ; 180, 240            ]';
% Fish.Protocole{4} = [0, 60        ; 60, 120             ; 120, 180            ; 240, 300 ; 180, 240            ]';
% 
% %%%% Parameters %%%%%
% Freq = 0.2;
% PlotAmp = 5;
% RealAmp = 2.5;
% PlotPeriodeCor = 6;
% Plus = '';
% PathSave = ['/Users/Projects/RLS/Data/Analysis/', num2str(Freq)];
% 
% %% Amplitude 5 degrees and frequency 0.2Hz
% close all;
% clc; clear all
% 
% %%%% Fish Path %%%%%
% Fish.Path{1} = '/Users/Projects/RLS/Data/Behavior2019-05-15/F1/10';
% %Fish.Path{2} = '/Users/Projects/RLS/Data/Behavior2019-05-15/F2/10';
% Fish.Path{2} = '/Users/Projects/RLS/Data/Behavior2019-05-16/F1/10';
% Fish.Path{3} = '/Users/Projects/RLS/Data/Behavior2019-05-16/F2/10';
% Fish.Path{4} = '/Users/Projects/RLS/Data/Behavior2019-05-16/F3/10';
% 
% Fish.Title{1} = 'F1-2019/05/15';
% %Fish.Title{2} = 'F2 2019/05/15';
% Fish.Title{2} = 'F1-2019/05/16';
% Fish.Title{3} = 'F2-2019/05/16';
% Fish.Title{4} = 'F3-2019/05/16';
% 
% %%%% Fish Protocoles %%%%%
% NumPro = 5;
% Protocole         = {'Vestibular' ; 'Vestibular+Visual' ; 'Vestibular-Visual' ; 'Visual' ; 'Vestibular+2Visual'};
% Fish.Protocole{1} = [0, 60        ; 60, 120             ; 120, 180            ; 180, 240]';
% %Fish.Protocole{2} = [0, 60        ; 60, 120             ; 120, 180            ; 180, 240]';
% Fish.Protocole{2} = [0, 60        ; 60, 120             ; 120, 180            ; 240, 300 ; 180, 240            ]';
% Fish.Protocole{3} = [0, 60        ; 60, 120             ; 120, 180            ; 240, 300 ; 180, 240            ]';
% Fish.Protocole{4} = [0, 60        ; 60, 120             ; 120, 180            ; 240, 300 ; 180, 240            ]';
% 
% %%%% Parameters %%%%%
% Freq = 0.2;
% PlotAmp = 10;
% RealAmp = 5;
% PlotPeriodeCor = 6;
% Plus = '';
% PathSave = ['/Users/Projects/RLS/Data/Analysis/', num2str(Freq)];
% 
% %% Amplitude 10 degrees and frequency 0.2Hz
% close all;
% clc; clear all
% 
% %%%% Fish Path %%%%%
% Fish.Path{1} = '/Users/Projects/RLS/Data/Behavior2019-05-15/F1/20';
% %Fish.Path{2} = '/Users/Projects/RLS/Data/Behavior2019-05-15/F2/10';
% Fish.Path{2} = '/Users/Projects/RLS/Data/Behavior2019-05-16/F1/20';
% Fish.Path{3} = '/Users/Projects/RLS/Data/Behavior2019-05-16/F2/20';
% Fish.Path{4} = '/Users/Projects/RLS/Data/Behavior2019-05-16/F3/20';
% 
% Fish.Title{1} = 'F1-2019/05/15';
% %Fish.Title{2} = 'F2 2019/05/15';
% Fish.Title{2} = 'F1-2019/05/16';
% Fish.Title{3} = 'F2-2019/05/16';
% Fish.Title{4} = 'F3-2019/05/16';
% 
% %%%% Fish Protocoles %%%%%
% NumPro = 5;
% Protocole         = {'Vestibular' ; 'Vestibular+Visual' ; 'Vestibular-Visual' ; 'Visual' ; 'Vestibular+2Visual'};
% Fish.Protocole{1} = [0, 60        ; 60, 120             ; 120, 180            ; 180, 240]';
% %Fish.Protocole{2} = [0, 60        ; 60, 120             ; 120, 180            ; 180, 240]';
% Fish.Protocole{2} = [0, 60        ; 60, 120             ; 120, 180            ; 240, 300 ; 180, 240            ]';
% Fish.Protocole{3} = [0, 60        ; 60, 120             ; 120, 180            ; 240, 300 ; 180, 240            ]';
% Fish.Protocole{4} = [0, 60        ; 60, 120             ; 120, 180            ; 240, 300 ; 180, 240            ]';
% 
% %%%% Parameters %%%%%
% Freq = 0.2;
% PlotAmp = 13;
% RealAmp = 10;
% PlotPeriodeCor = 6;
% Plus = '';
% PathSave = ['/Users/Projects/RLS/Data/Analysis/', num2str(Freq)];
% 
% %% Amplitude 5 degrees and frequency 0.1Hz
% close all;
% clc; clear all
% 
% %%%% Fish Path %%%%%
% Fish.Path{1} = '/Users/Projects/RLS/Data/2019-05-30_Behavior/Run 02';
% Fish.Path{2} = '/Users/Projects/RLS/Data/2019-05-30_Behavior/Run 05';
% Fish.Path{3} = '/Users/Projects/RLS/Data/2019-05-30_Behavior/Run 06';
% Fish.Path{4} = '/Users/Projects/RLS/Data/2019-05-30_Behavior/Run 09';
% Fish.Path{5} = '/Users/Projects/RLS/Data/2019-05-30_Behavior/Run 10';
% Fish.Path{6} = '/Users/Projects/RLS/Data/2019-05-30_Behavior/Run 14';
% Fish.Path{7} = '/Users/Projects/RLS/Data/2019-05-30_Behavior/Run 17';
% 
% Fish.Title{1} = 'F1-2019/05/30';
% Fish.Title{2} = 'F2-2019/05/30';
% Fish.Title{3} = 'F3-2019/05/30';
% Fish.Title{4} = 'F4-2019/05/30';
% Fish.Title{5} = 'F5-2019/05/30';
% Fish.Title{6} = 'F7-2019/05/30';
% Fish.Title{7} = 'F8-2019/05/30';
% 
% %%%% Fish Protocoles %%%%%
% NumPro = 6;
% Protocole         = {'Vestibular' ; 'Vestibular+Visual' ; 'Visual' ; 'Vestibular-Visual' ; 'Vestibular-2Visual' ; 'Vestibular+2Visual'};
% Fish.Protocole{1} = [0, 60        ; 120, 180            ; 240, 300 ; 360, 420            ; 480, 540             ; 600, 660            ]';
% Fish.Protocole{2} = [0, 60        ; 120, 180            ; 240, 300 ; 360, 420            ; 480, 540             ; 600, 660            ]';
% Fish.Protocole{3} = [0, 60        ; 120, 180            ; 240, 300 ; 360, 420            ; 480, 540             ; 600, 660            ]';
% Fish.Protocole{4} = [0, 60        ; 120, 180            ; 240, 300 ; 360, 420            ; 480, 540             ; 600, 660            ]';
% Fish.Protocole{5} = [0, 60        ; 120, 180            ; 240, 300 ; 360, 420            ; 480, 540             ; 600, 660            ]';
% Fish.Protocole{6} = [0, 60        ; 120, 180            ; 240, 300 ; 360, 420            ; 480, 540             ; 600, 660            ]';
% Fish.Protocole{7} = [0, 60        ; 120, 180            ; 240, 300 ; 360, 420            ; 480, 540             ; 600, 660            ]';
% 
% %%%% Parameters %%%%%
% Freq = 0.1;
% PlotAmp = 5;
% RealAmp = 5;
% PlotPeriodeCor = 1;
% Plus = '';
% PathSave = ['/Users/Projects/RLS/Data/Analysis/', num2str(Freq)];
% 
% %% Amplitude 10 degrees and frequency 0.1Hz
% close all;
% clc; clear all
% 
% %%%% Fish Path %%%%%
% Fish.Path{1} = '/Users/Projects/RLS/Data/2019-05-30_Behavior/Run 03';
% Fish.Path{2} = '/Users/Projects/RLS/Data/2019-05-30_Behavior/Run 07';
% Fish.Path{3} = '/Users/Projects/RLS/Data/2019-05-30_Behavior/Run 08';
% Fish.Path{4} = '/Users/Projects/RLS/Data/2019-05-30_Behavior/Run 11';
% Fish.Path{5} = '/Users/Projects/RLS/Data/2019-05-30_Behavior/Run 12';
% Fish.Path{6} = '/Users/Projects/RLS/Data/2019-05-30_Behavior/Run 15';
% Fish.Path{7} = '/Users/Projects/RLS/Data/2019-05-30_Behavior/Run 16';
% 
% Fish.Title{1} = 'F2-2019/05/30';
% Fish.Title{2} = 'F3-2019/05/30';
% Fish.Title{3} = 'F4-2019/05/30';
% Fish.Title{4} = 'F5-2019/05/30';
% Fish.Title{5} = 'F6-2019/05/30';
% Fish.Title{6} = 'F7-2019/05/30';
% Fish.Title{7} = 'F8-2019/05/30';
% 
% %%%% Fish Protocoles %%%%%
% NumPro = 6;
% Protocole         = {'Vestibular' ; 'Vestibular+Visual' ; 'Visual' ; 'Vestibular-Visual' ; 'Vestibular-2Visual' ; 'Vestibular+2Visual'};
% Fish.Protocole{1} = [0, 60        ; 120, 180            ; 240, 300 ; 360, 420            ; 480, 540             ; 600, 650            ]';
% Fish.Protocole{2} = [0, 60        ; 120, 180            ; 240, 300 ; 360, 420            ; 480, 540             ; 600, 650            ]';
% Fish.Protocole{3} = [0, 60        ; 120, 180            ; 240, 300 ; 360, 420            ; 480, 540             ; 600, 650            ]';
% Fish.Protocole{4} = [0, 60        ; 120, 180            ; 240, 300 ; 360, 420            ; 480, 540             ; 600, 650            ]';
% Fish.Protocole{5} = [0, 60        ; 120, 180            ; 240, 300 ; 360, 420            ; 480, 540             ; 600, 650            ]';
% Fish.Protocole{6} = [0, 60        ; 120, 180            ; 240, 300 ; 360, 420            ; 480, 540             ; 600, 650            ]';
% Fish.Protocole{7} = [0, 60        ; 120, 180            ; 240, 300 ; 360, 420            ; 480, 540             ; 600, 650            ]';
% 
% %%%% Parameters %%%%%
% Freq = 0.1;
% PlotAmp = 13;
% RealAmp = 10;
% PlotPeriodeCor = 1;
% Plus = '';
% PathSave = ['/Users/Projects/RLS/Data/Analysis/', num2str(Freq)];
% 
% %% Amplitude 10 degrees and frequency 0.2Hz H2B:HUC:GCaMP6f
% close all;
% clc; clear all
% 
% %%%% Fish Path %%%%%
% Fish.Path{1} = '/Users/Projects/RLS/Data/2019-06-01_Behavior/Run 04';
% Fish.Path{2} = '/Users/Projects/RLS/Data/2019-06-01_Behavior/Run 06';
% Fish.Path{3} = '/Users/Projects/RLS/Data/2019-06-01_Behavior/Run 07';
% 
% Fish.Title{1} = 'F1-2019/06/01';
% Fish.Title{2} = 'F2-2019/06/01';
% Fish.Title{3} = 'F3-2019/06/01';
% 
% %%%% Fish Protocoles %%%%%
% NumPro = 6;
% Protocole         = {'Vestibular' ; 'Vestibular+Visual' ; 'Visual' ; 'Vestibular-Visual' ; 'Vestibular-2Visual' ; 'Vestibular+2Visual'};
% Fish.Protocole{1} = [0, 180       ; 240, 420            ; 480, 660 ; 720, 900            ; 960, 1140            ; 1200, 1370         ]';
% Fish.Protocole{2} = [0, 180       ; 240, 420            ; 480, 660 ; 720, 900            ; 960, 1140            ; 1200, 1370         ]';
% Fish.Protocole{3} = [0, 180       ; 240, 420            ; 480, 660 ; 720, 900            ; 960, 1140            ; 1200, 1370         ]';
% 
% %%%% Parameters %%%%%
% Freq = 0.2;
% PlotAmp = 9;
% RealAmp = 10;
% PlotPeriodeCor = 5;
% Plus = '';
% PathSave = ['/Users/Projects/RLS/Data/Analysis/', num2str(Freq), 'H2B'];
% 
% %% Amplitude 10 degrees and frequency 0.2Hz + Laser H2B:HUC:GCaMP6f
% close all;
% clc; clear all
% 
% %%%% Fish Path %%%%%
% Fish.Path{1} = '/Users/Projects/RLS/Data/2019-06-01_Behavior/Run 03';
% Fish.Path{2} = '/Users/Projects/RLS/Data/2019-06-01_Behavior/Run 05';
% Fish.Path{3} = '/Users/Projects/RLS/Data/2019-06-01_Behavior/Run 08';
% 
% Fish.Title{1} = 'F1-2019/06/01';
% Fish.Title{2} = 'F2-2019/06/01';
% Fish.Title{3} = 'F3-2019/06/01';
% 
% %%%% Fish Protocoles %%%%%
% NumPro = 6;
% Protocole         = {'Vestibular' ; 'Vestibular+Visual' ; 'Visual' ; 'Vestibular-Visual' ; 'Vestibular-2Visual' ; 'Vestibular+2Visual'};
% Fish.Protocole{1} = [0, 180       ; 240, 420            ; 480, 660 ; 720, 900            ; 960, 1140            ; 1200, 1370         ]';
% Fish.Protocole{2} = [0, 180       ; 240, 420            ; 480, 660 ; 720, 900            ; 960, 1140            ; 1200, 1370         ]';
% Fish.Protocole{3} = [0, 180       ; 240, 420            ; 480, 660 ; 720, 900            ; 960, 1140            ; 1200, 1370         ]';
% 
% %%%% Parameters %%%%%
% Freq = 0.2;
% PlotAmp = 9;
% RealAmp = 10;
% PlotPeriodeCor = 5;
% Plus = 'Laser';
% PathSave = ['/Users/Projects/RLS/Data/Analysis/', num2str(Freq), 'H2B'];
% 
% %% Amplitude 10 degrees and frequency 0.2Hz Corrected
% close all;
% clc; clear all
% 
% %%%% Fish Path %%%%%
% Fish.Path{1} = '/Users/Projects/RLS/Data/2019-06-11/Run 01';
% Fish.Path{2} = '/Users/Projects/RLS/Data/2019-06-11/Run 06';
% Fish.Path{3} = '/Users/Projects/RLS/Data/2019-06-11/Run 08';
% Fish.Path{4} = '/Users/Projects/RLS/Data/2019-06-11/Run 11';
% Fish.Path{5} = '/Users/Projects/RLS/Data/2019-06-11/Run 12';
% Fish.Path{6} = '/Users/Projects/RLS/Data/2019-06-11/Run 15';
% 
% Fish.Title{1} = 'F1-2019/06/11';
% Fish.Title{2} = 'F3-2019/06/11';
% Fish.Title{3} = 'F5-2019/06/11';
% Fish.Title{4} = 'F6-2019/06/11';
% Fish.Title{5} = 'F7-2019/06/11';
% Fish.Title{6} = 'F8-2019/06/11';
% 
% %%%% Fish Protocoles %%%%%
% NumPro = 6;
% Protocole         = {'Vestibular' ; 'Vestibular+Visual' ; 'Visual' ; 'Vestibular2' ; 'Vestibular+2Visual' ; 'Visual2'};
% Fish.Protocole{1} = [0, 120       ; 180, 300            ; 360, 480 ; 540, 660            ; 720, 840             ; 900, 1020          ]';
% Fish.Protocole{2} = [0, 120       ; 180, 300            ; 360, 480 ; 540, 660            ; 720, 840             ; 900, 1020          ]';
% Fish.Protocole{3} = [0, 120       ; 180, 300            ; 360, 480 ; 540, 660            ; 720, 840             ; 900, 1020          ]';
% Fish.Protocole{4} = [0, 120       ; 180, 300            ; 360, 480 ; 540, 660            ; 720, 840             ; 900, 1020          ]';
% Fish.Protocole{5} = [0, 120       ; 180, 300            ; 360, 480 ; 540, 660            ; 720, 840             ; 900, 1015          ]';
% Fish.Protocole{6} = [0, 120       ; 180, 300            ; 360, 480 ; 540, 660            ; 720, 840             ; 900, 1020          ]';
% 
% %%%% Parameters %%%%%
% Freq = 0.2;
% PlotAmp = 12;
% RealAmp = 10;
% PlotPeriodeCor = 5;
% Plus = 'Cor';
% PathSave = ['/Users/Projects/RLS/Data/Analysis/', num2str(Freq), 'Cor'];

%% Amplitude 10 degrees and frequency 0.2Hz Corrected Fixe
close all;
clc; clear all

%%%% Fish Path %%%%%
Fish.Path{1} = '/Users/Projects/RLS/Data/2019-06-11/Run 03';
Fish.Path{2} = '/Users/Projects/RLS/Data/2019-06-11/Run 05';
Fish.Path{3} = '/Users/Projects/RLS/Data/2019-06-11/Run 09';
Fish.Path{4} = '/Users/Projects/RLS/Data/2019-06-11/Run 10';
Fish.Path{5} = '/Users/Projects/RLS/Data/2019-06-11/Run 13';
Fish.Path{6} = '/Users/Projects/RLS/Data/2019-06-11/Run 14';

Fish.Title{1} = 'F1-2019/06/11';
Fish.Title{2} = 'F3-2019/06/11';
Fish.Title{3} = 'F5-2019/06/11';
Fish.Title{4} = 'F6-2019/06/11';
Fish.Title{5} = 'F7-2019/06/11';
Fish.Title{6} = 'F8-2019/06/11';

%%%% Fish Protocoles %%%%%
NumPro = 4;
Protocole         = {'Vestibular' ; 'Vestibular-Visual' ; 'Visual' ; 'Vestibular2' };
Fish.Protocole{1} = [0, 120       ; 180, 300            ; 360, 480 ; 540, 660     ]';
Fish.Protocole{2} = [0, 120       ; 180, 300            ; 360, 480 ; 540, 660     ]';
Fish.Protocole{3} = [0, 120       ; 180, 300            ; 360, 480 ; 540, 660     ]';
Fish.Protocole{4} = [0, 120       ; 180, 300            ; 360, 480 ; 540, 655     ]';
Fish.Protocole{5} = [0, 120       ; 180, 300            ; 360, 480 ; 540, 660     ]';
Fish.Protocole{6} = [0, 120       ; 180, 300            ; 360, 480 ; 540, 660     ]';

%%%% Parameters %%%%%
Freq = 0.2;
PlotAmp = 12;
RealAmp = 10;
PlotPeriodeCor = 5;
Plus = 'CorFixe';
PathSave = ['/Users/Projects/RLS/Data/Analysis/', num2str(Freq), 'CorFixe'];
%%
%%%% Initialization %%%%%
TrackMeanMean = zeros(int16(1/(Freq*0.1)), NumPro);
FishNum = zeros(NumPro, 1);
Trackstd = zeros(int16(1/(Freq*0.1)),  NumPro);
TrackAmp = zeros(size(Fish.Path, 2), NumPro);
TrackPhase = zeros(size(Fish.Path, 2), NumPro);

%%%% Plots %%%%%
for i = 1:size(Fish.Path, 2)
    
    % Load Stimuli
    Mot = readtable([Fish.Path{i}, '/Stimulus.txt'],'Format','%f%f%f');
    Mot.Var2 = Mot.Var2-Mot.Var2(1);
    [TimeMotCor, IA] = unique(Mot.Var2,'stable');
    MotorCorrected = Mot.Var3(IA);
    
    Vis = readtable([Fish.Path{i}, '/StimulusVisualVestibular.txt'],'Format','%f%f%f');
    Vis.Visual = -Vis.Visual/max(Vis.Visual(Vis.Visual<Fish.Protocole{1}(5)))*max(Mot.Var3);
    Vis.Time = Vis.Time-Vis.Time(1);
    [TimeCorrected, IA] = unique(Vis.Time,'stable');
    VisualCorrected = Vis.Visual(IA);
    
    %%%% Raw signal %%%%
    figure(1);
    subplot(size(Fish.Path, 2), 1, i);
    for p = 1:size(Fish.Protocole{i}, 2)
        x = [Fish.Protocole{i}(p*2-1) Fish.Protocole{i}(p*2) Fish.Protocole{i}(p*2) Fish.Protocole{i}(p*2-1)];
        y = [-(PlotAmp+2) -(PlotAmp+2) (PlotAmp+2) (PlotAmp+2)];
        patch(x, y,'black', 'FaceAlpha', .05*p, 'EdgeAlpha', .05*p);
    end
    hold on;
    p1 = plot(TimeCorrected, VisualCorrected, 'r', 'LineWidth', 0.5);
    p2 = plot(TimeMotCor, MotorCorrected, 'b', 'LineWidth', 0.5);
    ylim([-(PlotAmp+2) (PlotAmp+2)]);
    ylabel('Angle (degree)');
    xlabel('Time (s)');
    title([Fish.Title{i}, ' Amplitude = ', num2str(RealAmp), ' degrees and Frequency = ', num2str(Freq), ' Hz']);
    
    % Load Tracking
    file = dir([Fish.Path{i}, '/', '*Tracking.txt']);
    Tra = readtable([Fish.Path{i}, '/', file.name],'Format','%f%f');
    % Filtering
    d1 = designfilt('lowpassiir','FilterOrder',12, ...
        'HalfPowerFrequency',0.15,'DesignMethod','butter');
    %plot(Tra.Var1-Tra.Var1(1), filtfilt(d1,(Tra.Var2-mean(Tra.Var2))), 'k', 'LineWidth', 1);
    Track = -Tra.Var2;
    Track(Tra.Var2 == 0) = NaN;
    Track = Track - nanmean(Track);
    p3 = plot(Tra.Var1-Tra.Var1(1), Track, 'k', 'LineWidth', 1);
    legend([p3 p2 p1], 'Behavior', 'Vestibular', 'Visual');
    
    %%%% Average %%%%
    figure(2)
    for p = 1:size(Fish.Protocole{i}, 2)
        
        % Plot Tracking Average
        clear TimeNew
        TimeOld = Tra.Var1-Tra.Var1(1);
        TimeNew = 0:0.1:TimeOld(end);
        TraNew = interp1(TimeOld, -Tra.Var2, TimeNew);
        TraNewPro = TraNew((Fish.Protocole{i}(p*2-1)/0.1+1) : Fish.Protocole{i}(p*2)/0.1);
        TrackMean = reshape( TraNewPro, [ int16(1/(Freq*0.1)), int16( (size(TraNewPro, 2)/(1/(Freq*0.1))) ) ] );
        TrackMean(TrackMean == 0) = NaN;
        Trackstd(:,p) = nanstd(TrackMean, 0, 2);
        TrackMean = nanmean(TrackMean, 2);
        TrackMean = TrackMean - mean(TrackMean);
        subplot(size(Fish.Path, 2)+1, NumPro, ((i-1)*(NumPro))+p);
        p3 = plot( TimeNew(1:(1/(Freq*0.1)+1)), -TrackMean,'k', 'LineWidth', 1);
        title({[Fish.Title{i}, ' A = ', num2str(RealAmp), ' deg, F = ', num2str(Freq), ' Hz'] ; ['(',Protocole{p} , ')']});
        ylim([-(PlotAmp+2) (PlotAmp+2)]);
        ylabel('Angle (degree)');
        hold on;
        
        % Plot Visual Stimulus
        VisualCorrected(isnan(VisualCorrected)) = 0;
        VisNew = interp1(TimeCorrected, VisualCorrected, TimeNew);
        VisNewPro = VisNew((Fish.Protocole{i}(p*2-1)/0.1+1) : Fish.Protocole{i}(p*2)/0.1);
        if p ~= 1
            p1 = plot(TimeNew(1:(1/(Freq*0.1)+1)), VisNewPro((1/(Freq*0.1))+1:(1/(Freq*0.1))*2), 'r', 'LineWidth', 0.8);
        end
        
        % Plot Motor Stimulus
        MotorCorrected(isnan(MotorCorrected)) = 0;
        MotNew = interp1(TimeMotCor, MotorCorrected, TimeNew);
        MotNewPro = MotNew((Fish.Protocole{i}(p*2-1)/0.1+1) : Fish.Protocole{i}(p*2)/0.1);
        p2 = plot(TimeNew(1:(1/(Freq*0.1)+1)), MotNewPro((1/(Freq*0.1))*PlotPeriodeCor+1:(1/(Freq*0.1))*(PlotPeriodeCor+1)), 'b', 'LineWidth', 0.8);
        
        TrackMeanMean(:,p) = TrackMean + TrackMeanMean(:,p);
        FishNum(p) = 1 + FishNum(p);
        
        % fft Tracking
        Trackfft = fft(TraNewPro);
        L = size(TraNewPro, 2);
        Fs = 1/0.1;
        P2 = abs(Trackfft/L);
        P1 = P2(1:L/2+1);
        P1(2:end-1) = 2*P1(2:end-1);
        f = Fs*(0:(L/2))/L;
        indfstim = find(f == Freq);
        TrackPhase(i, p) = angle(Trackfft(indfstim)); 
        TrackAmp(i, p) = P1(f == Freq);
        Category{i, p} = Protocole{p};
        
        % fft Motor
        Motorfft = fft(MotNewPro);
        L = size(MotNewPro, 2);
        Fs = 1/0.1;
        P2 = abs(Motorfft/L);
        P1 = P2(1:L/2+1);
        P1(2:end-1) = 2*P1(2:end-1);
        f = Fs*(0:(L/2))/L;
        indfstim = find(f == Freq);
        MotorPhase(i, p) = angle(Motorfft(indfstim)); 
        MotorAmp(i, p) = P1(f == Freq);

    end
    legend([p3 p2 p1], 'Behavior', 'Vestibular', 'Visual');
end
%
figure(2)
for p = 1:size(Fish.Protocole{i}, 2)
    TrackMeanMean(:, p) = TrackMeanMean(:, p) / FishNum(p);
    subplot(size(Fish.Path, 2)+1, NumPro, (size(Fish.Path, 2)*NumPro)+p);
    plot(TimeNew(1:(1/(Freq*0.1)+1)), TrackMeanMean(:, p), 'k', 'LineWidth', 1);
    hold on;
    % Plot Visual Stimulus
    VisNewPro = VisNew((Fish.Protocole{i}(p*2-1)/0.1+1) : Fish.Protocole{i}(p*2)/0.1);
    if p ~= 1
        plot(TimeNew(1:(1/(Freq*0.1)+1)), VisNewPro((1/(Freq*0.1))+1:(1/(Freq*0.1))*2), 'r', 'LineWidth', 0.8);
    end
    % Plot Motor Stimulus
    MotNewPro = MotNew((Fish.Protocole{i}(p*2-1)/0.1+1) : Fish.Protocole{i}(p*2)/0.1);
    plot(TimeNew(1:(1/(Freq*0.1)+1)), MotNewPro((1/(Freq*0.1))*PlotPeriodeCor+1:(1/(Freq*0.1))*(PlotPeriodeCor+1)), 'b', 'LineWidth', 0.8);
    xlabel('Time (s)');
    ylabel('Angle (degree)');
    title({['Average n = ',  num2str(FishNum(p)),  ' A = ', num2str(PlotAmp), ' deg, F = ', num2str(Freq), ' Hz'] ; ['(',Protocole{p} , ')']});
    ylim([-(PlotAmp+2) (PlotAmp+2)]);
    shadedErrorBar(TimeNew(1:(1/(Freq*0.1)+1)), TrackMeanMean(:, p), Trackstd(:,p)/sqrt(FishNum(p)));
end
legend('Behavior', 'Vestibular', 'Visual');
clc

%% Save
save([PathSave, '/', Plus, 'Amp', num2str(RealAmp), 'Freq', num2str(Freq), 'NumPro', num2str(NumPro), '.mat'], 'TrackAmp', 'TrackPhase', 'Category', 'FishNum', 'Protocole', 'RealAmp', 'Freq', 'Fish');
savefig(figure(1), [PathSave, '/Plot/', Plus, 'Amp', num2str(RealAmp), 'Freq', num2str(Freq), 'NumPro', num2str(NumPro), 'SingleFish.fig']);
savefig(figure(2), [PathSave, '/Plot/', Plus,'Amp', num2str(RealAmp), 'Freq', num2str(Freq), 'NumPro', num2str(NumPro), 'Avg.fig']);
saveas(figure(1), [PathSave, '/Plot/', Plus, 'Amp', num2str(RealAmp), 'Freq', num2str(Freq), 'NumPro', num2str(NumPro), 'SingleFish.svg']);
saveas(figure(2), [PathSave, '/Plot/', Plus,'Amp', num2str(RealAmp), 'Freq', num2str(Freq), 'NumPro', num2str(NumPro), 'Avg.svg']);
saveas(figure(1), [PathSave, '/Plot/', Plus, 'Amp', num2str(RealAmp), 'Freq', num2str(Freq), 'NumPro', num2str(NumPro), 'SingleFish.png']);
saveas(figure(2), [PathSave, '/Plot/', Plus,'Amp', num2str(RealAmp), 'Freq', num2str(Freq), 'NumPro', num2str(NumPro), 'Avg.png']);

%% Plot Mean
%clc; clear all; close all;
Path = '/Users/Projects/RLS/Data/Analysis/0.2Cor';

%AmpColor{1} = [0.8 0.9 0]; % Orange
AmpColor{1} = [0.4 0.6 0]; % Green
%AmpColor{3} = [0.1 0.3 0]; % Blue
File = dir(Path);

figure(3)
for i = 1:size(AmpColor, 2)
    load([Path, '/',  File((i-1)*3+4).name]);
    NumPro = size(Protocole, 1);
    TrackAmp(TrackAmp == 0) = NaN;
    TrackGain = TrackAmp/RealAmp;
    TrackAmpError = nanstd(TrackGain, 1);
    TrackAmpMean = nansum(TrackGain, 1);
    for p = 1:size(TrackAmp, 2)
        TrackAmpMean(p) = TrackAmpMean(p)/FishNum(p);
        P = errorbar(p, TrackAmpMean(p), TrackAmpError(p)/sqrt(FishNum(p)), 'Color', AmpColor{i}, 'LineWidth', 2);
        hold on;
        ax = gca;
        ax.XTickLabel{p+1} = Protocole{p};
        ax.XTick = 0:NumPro;
        if i == 1
            MaxGain = TrackAmpMean;
        elseif MaxGain(p) < TrackAmpMean(p)
            MaxGain(p) = TrackAmpMean(p);
        end
    end
    Pl{i} = plot([1:NumPro], TrackAmpMean, 'Color', AmpColor{i}, 'LineWidth', 2);
    Amp(i) = RealAmp;
end

ax = gca;
xlim([0 NumPro+1]);
ylim([0 1.2]);
ax.XTickLabelRotation = 45;
ax.YLabel.String = 'Gain';
ax.FontSize = 25;
ax.XTickLabel{1} = '';
for c = size(Protocole, 1)+2:size(ax.XTickLabel, 1)
    ax.XTickLabel{c} = '';
end
for p = 1:size(TrackAmp, 2)
    text(p-0.09,MaxGain(p)+0.15,['n=', num2str(FishNum(p))], 'FontSize',25);
end
grid;
lgd = legend([Pl{1}], [num2str(Amp(1)), char(176)], 'Location','northwest');
%lgd = legend([Pl{1}, Pl{2}], [num2str(Amp(1)), char(176)], [num2str(Amp(2)), char(176), ' Laser ON'], 'Location','northwest');
%lgd = legend([Pl{1}, Pl{2}, Pl{3}], [num2str(Amp(1)), char(176)], [num2str(Amp(2)), char(176)], [num2str(Amp(3)), char(176)], 'Location','northwest');

title(lgd,'Amplitude of Stimulation')
title(['Gain of the VOR at ', num2str(Freq), ' Hz.']);

%% Save
savefig(figure(3), [Path, '/Plot/Gain', 'Freq', num2str(Freq), 'NumPro', num2str(NumPro), '.fig']);
saveas(figure(3), [Path, '/Plot/Gain', 'Freq', num2str(Freq), 'NumPro', num2str(NumPro), '.svg']);
saveas(figure(3), [Path, '/Plot/Gain', 'Freq', num2str(Freq), 'NumPro', num2str(NumPro), '.png']);

%% BBoxPlot
Path = '/Users/Projects/RLS/Data/Analysis/0.2Cor';
File = dir(Path);
Num = 1;

figure(4)
for i = 1:Num
    load([Path, '/',  File((i-1)*3+4).name]);
    figure(4)
    subplot(1,Num,i);
    lineamp = TrackGain(:);
    lincat = {Category{:}};
    lincat(isnan(lineamp))=[];
    lineamp(isnan(lineamp))=[];
    boxplot(lineamp, lincat);
    set(findobj(gca,'type','line'),'linew',2)
    ax = gca;
    hold on;
    ax.XTickLabelRotation = 45;
    ax.YLabel.String = 'Gain';
    ax.FontSize = 25;
    grid;
end
title(['Gain of the VOR at ', num2str(Freq), ' Hz and an Amplitude of ', num2str(Amp(1)), char(176), ' (n = ', num2str(size(TrackGain, 1)), ')']);

for i = 1:size(TrackAmp, 1)
    F = plot(TrackGain(i,:), ':+', 'LineWidth', 1.5)
    ax = gca;
    hold on;
    ax.XTickLabelRotation = 45;
    ax.YLabel.String = 'Gain';
    ax.FontSize = 25;
end
legend(Fish.Title);
%% Save
Path = '/Users/migault/PhD/Presentations/2019/Toscany';
mkdir([Path, '/Plot']);
savefig(figure(4), [Path, '/Plot/GainBoxPlot', 'Freq', num2str(Freq), 'NumPro', num2str(NumPro), '.fig']);
saveas(figure(4), [Path, '/Plot/GainBoxPlot', 'Freq', num2str(Freq), 'NumPro', num2str(NumPro), '.svg']);
saveas(figure(4), [Path, '/Plot/GainBoxPlot', 'Freq', num2str(Freq), 'NumPro', num2str(NumPro), '.png']);


